---
title: "p8105_hw3_amv2187"
author: "Alyssa Vanderbeek (amv2187)"
date: "15 October 2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(p8105.datasets)
library(tidyverse)

getwd()

theme_set(theme_bw() + 
            theme(legend.position = "bottom"))
```


## Problem 1

```{r}
data("brfss_smart2010") 

brfss_cleaned = brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(topic == 'Overall Health' & response %in% c('Excellent', 'Very good', 'Good', 'Fair', 'Poor')) %>%
  mutate(response = factor(response, ordered = TRUE, levels = c('Excellent', 'Very good', 'Good', 'Fair', 'Poor'))) %>%
  rename(state = locationabbr,
         county = locationdesc)

str(brfss_cleaned)
```


```{r}
# Which states were observed at 7 locations in 2002?
brfss_cleaned %>%
  filter(year == 2002) %>%  # filter to only listings in 2002
  distinct(state, county) %>%  # select distinct state and county variables
  group_by(state) %>% # get distinct locations
  filter(n() == 7) %>%  # state listings that have exactly 7 counties listed
  distinct(state) # get states

# Make a “spaghetti plot” that shows the number of locations in each state from 2002 to 2010.
brfss_cleaned %>%
  distinct(state, county, year) %>%
  count(state, year) %>%
  ggplot(aes(x = year, y = n, color = state)) +
  geom_line(alpha = 0.6) + 
  labs(
    title = 'Number of counties that responded 2002-2010',
    y = 'Number of counties',
    x = 'Year', 
    fill = 'x'
  ) +
  theme(legend.position = 'right')
  # geom_smooth(method = 'loess', se = F, alpha = 0.5)


# Make a table showing, for the years 2002, 2006, and 2010, the mean and standard deviation of the proportion of “Excellent” responses across locations in NY State.
brfss_cleaned %>%
  filter(year %in% c(2002, 2006, 2010) & 
         response == 'Excellent' & 
         state == 'NY') %>% 
  group_by(year) %>%
  summarise(Average = mean(data_value), 
            'Std Dev' = sd(data_value)) %>%
  knitr::kable(caption = 'Proportion of "Excellent" responses in NY state' )


# For each year and state, compute the average proportion in each response category (taking the average across locations in a state). Make a five-panel plot that shows, for each response category separately, the distribution of these state-level averages over time.
brfss_cleaned %>% 
  group_by(year, state, response) %>%
  summarise(avg = mean(data_value, na.rm = T)) %>% 
  ggplot(aes(x = year, y = avg, color = state)) +
  geom_line(alpha = 0.5) +
  facet_grid(~response) + 
  labs(
    title = 'Average proportion of responses',
    y = 'Average proportion of responses',
    x = 'Year'
  ) + 
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  guides(colour = guide_legend(nrow = 4, byrow = T)) 

```



## Problem 2

```{r}
data("instacart")
#View(instacart[1:100,])

```

What are the average/median/maximum number of items purchased by people?
On what day(s) of the week are the most items purchased? The least?
What types of food are purchased most often?
Is there an association between the number of items a person purchased and the number of prior visits they've made?
Is there a pattern that is commonly followed in the store? (i.e. an association between a product's aisle and order of addition to cart)
At what time of day do most orders take place?

```{r}
aisles = instacart %>%
  group_by(aisle, aisle_id, department, department_id) %>%
  count %>%
  arrange(department, n)
  
nrow(aisles)

aisles %>%
  filter(n == max(.$n))

instacart %>%
  group_by(aisle) %>%
  count
  
ggplot(aisles, aes(x = aisle, y = n, color = department)) +
  geom_point(stat = 'identity') +
  facet_wrap(.~department, scales = 'free') +
  labs(
    title = 'Number of items purchased across aisles',
    x = 'Aisle'
  ) +
  #scale_y_continuous(limits = c(0, 50000)) +
  #scale_x_discrete(limits = aisles$aisle) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1),
        legend.position = 'none')
```

```{r}
items = instacart %>%
  group_by(product_name, aisle) %>%
  count %>%
  arrange(aisle)
```

## Problem 3

```{r}
data("ny_noaa")
```

